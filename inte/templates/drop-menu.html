
<!DOCTYPE html>
<html lang="en">
<head>
  {% load static %}
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Savic Tech</title>
  <link rel="stylesheet" href="{% static 'drop-menu.css' %}">
  {% comment %} <link rel="stylesheet" href="{% static 'dashboard.css' %}"> {% endcomment %}
  <link rel="shortcut icon" href="https://savictech.com/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="https://savictech.com/img/apple-touch-icon.png">
  {% comment %} for the lineChart {% endcomment %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Boxicons CDN Link -->
  <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
</head>
<body>
  <div class="sidebar close">
    {% comment %} <div class="logo-container">
      <img src="static/images/savic.png" alt="SAVIC Logo" class="logo">
    </div> {% endcomment %}
   
 
      <ul class="nav-links">
        <li>
          <ul class="sub-menu blank">
            <li><a class="link_name" href="#">Hand Written Invoice</a></li>
          </ul>
        </li>
        <li>
          <div class="iocn-link">
            <a href="#">
              <i class='bx bx-collection'></i>
              <span class="link_name">Hand Written Invoice</span>
            </a>
            <i class='bx bxs-chevron-down arrow'></i>
          </div>
          <ul class="sub-menu">
            <li><a onclick="window.location.href='upload.html'"><img src="static/images/multi.png" alt="Multi"> Multi Invoice</a></li>
            <li><a onclick="window.location.href='folder-upload.html'"><img src="static/images/folder.png" alt="folder"> Folder</a></li>
            <li><a onclick="window.location.href='drop-menu.html'"><img src="static/images/computer_12576904.png" alt="Dashboard"> Dashboard</a></li>
          </ul>
        </li>
        <li>
          <div class="iocn-link">
            <a href="#">
              <i class='bx bx-book-alt'></i>
              <span class="link_name">Scanned Invoice</span>
            </a>
            <i class='bx bxs-chevron-down arrow'></i>
          </div>
          <ul class="sub-menu">
            <li><a onclick="window.location.href='upload.html'"><img src="static/images/multi.png" alt="Multi"> Multi Invoice</a></li>
            <li><a onclick="window.location.href='folder-upload.html'"><img src="static/images/folder.png" alt="folder"> Folder</a></li>
            <li><a onclick="window.location.href='drop-menu.html'"><img src="static/images/computer_12576904.png" alt="Dashboard"> Dashboard</a></li>
          </ul>
        </li>
        <li>
          <div class="iocn-link">
            <a href="#">
              <i class='bx bx-spreadsheet'></i>
              <span class="link_name"  onclick="window.location.href='excel.html'">Excel Template Upload</span>
 
            </a>
          </div>
        </li>
      </ul>
    </div>
   
 
  <section class="home-section">
    <div class="home-content">
      <i class='bx bx-menu'></i>
      <h1 class="title">Vendor Dashboard</h1>
      {% comment %} <div class="user-menu">
        <span class="username">
          <i class="bx bx-user-circle icon"></i>
          <span class="greeting">Hello, {{ user.name }}!</span>
        </span>
        <div class="dropdown-content">
          {% if user.is_authenticated %}
          <form id="logoutForm" action="{% url 'logout' %}" method="post">
            {% csrf_token %}
            <a href="{% url 'logout' %}" id="logoutBtn"><i class="bx bx-log-out"></i>Logout</a>
          </form>
          {% else %}
          <p>Please <a href="{% url 'login' %}">login</a> to access this page.</p>
          {% endif %}
        </div>
      </div> {% endcomment %}
      {% comment %} <div class="col-lg-3 col-md-4 col-8">
        <form class="searchForm">
            <input class="searchStyle" type="text" placeholder="Search PO Number">
        </form>
    </div> {% endcomment %}
    <div class="col-lg-2 col-md-3 col-4 ">
        <div class="menu-trigger">
            <div class="d-flex align-items-center justify-content-center gap-3 userDesign" onclick="toggleMenu(event)">
                <img src="static/images/user.png" class="userLogo" alt="user logo" title="user logo">
                <i class='fas fa-angle-down fs-4'></i>
            </div>
            <div class="menu" id="account-menu">
                <div class="menu-arrow"></div>
                <div class="d-flex justify-content-start align-items-center gap-3 userImageDesign" >
                   
                    <div class="userImage">
                        <img src="static/images/avatar-01.jpg" class="" alt="Vendor Dashboard">
                    </div>
                 
                    <div class="pt-2">
                        <h5 class="fs-6"> {{ user.name }}</h5>
                        <h6 class="text-secondary f-6">{{ user.email }}</h6>
                    </div>
                </div>
                <div class="divider"></div>
                <div class="divider"></div>
 
                {% if user.is_authenticated %}
                    <form id="logoutForm" action="{% url 'logout' %}" method="post">
                    <div class="menu-item"  onclick="document.getElementById('logoutForm').submit();">
                        <div class="menu-icon">+</div>Add another account
                    </div>
                    {% comment %} <div class="menu-item">
                        <div class="menu-icon">⚙️</div>Settings
                    </div>  {% endcomment %}
                   
                        {% csrf_token %}
                        <div class="menu-item" onclick="document.getElementById('logoutForm').submit();">
                            <div class="menu-icon">↩️</div>Logout
                        </div>
                    </form>
                {% else %}
                    <p>Please <a href="{% url 'login' %}">login</a> to access this page.</p>
                {% endif %}
               
            </div>
        </div>
    </div>
   
    </div>
    </div>
 
    <hr>
 
    <div class="PO search">
      <form id="searchForm" method="GET" action="{% url 'search_po_or_invoice_number' %}" class="searchForm">
        <input class="searchStyle" type="text" name="search_query" placeholder="Search PO or Invoice Number" value="{{ request.GET.search_query|default_if_none:'' }}">
        <button type="submit" class="btn btn-primary">Search</button>
        <button type="button" class="btn btn-secondary" onclick="refreshPage()">Refresh</button>
      </form>
    </div>
 
   
     
      <div class="data">
        <div class="paragraph ">
          <div class="span-container">
            <span>{{ total_processed|default:0 }}</span>
          </div> <i
          class="fas fa-handshake fs-1 primary-text border rounded-full secondary-bg p-3" style="margin-left: 70%;"></i>
          <p>Total</p>
        </div>
 
        <div class="paragraph-success">
          <div class="span-container">
            <span>{{ success_count|default:0 }}</span>
          </div>
          <i class="fas fa-thumbs-up fs-1 primary-text border rounded-full secondary-bg p-3" style="margin-left: 70%;"></i>
          <p>Success </p>  
        </div>
 
        <div class="paragraph-fail">
          <div class="span-container">
            <span>{{ failed_count|default:0 }}</span>
          </div>
          <i class="fas fa-thumbs-down fs-1 primary-text border rounded-full secondary-bg p-3" style="margin-left: 70%;"></i>
 
          <p>Fail</p>
        </div>
 
      </div>
     
      <canvas id="combinedChart" width="1350" height="300"></canvas>
 
   
 
      <!-- <div class="container">
        <div id="dashboardTable">
          {% if invoices %}
            <table class="invoice-table">
              <thead>
                <tr>
                  <th>Invoice Number</th>
                  <th>Purchase Order Number</th>
                  <th>Vendor Name</th>
                  <th>Status</th>
                  <th>Date</th>
                </tr>
              </thead>
              <tbody>
                {% for invoice in invoices %}
                  <tr>
                    <td>{{ invoice.invoice_number }}</td>
                    <td>{{ invoice.purchase_order_number }}</td>
                    <td>{{ invoice.vendor_name }}</td>
                    <td class="{% if invoice.code == 'Success' %}success{% elif invoice.code == 'Error'%}failure{% endif %}">
                      {{ invoice.code }}
                    </td>
                    <td>{{ invoice.date }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <p>No invoices found.</p>
          {% endif %}
        </div>
      </div>
    </div> -->
 
     <div class="container">
      <div id="dashboardTable">
        {% include 'partials/invoice_table.html' %}
      </div>
    </div>
  </div>
 
  </section>
 
  <footer id="footer">
    <span>
      © 2024,
      <a href="http://www.savictech.com" target="_blank">savic technologies pvt. ltd.</a>
      All Rights Reserved.
    </span>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"></script>
 
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const userMenu = document.querySelector(".user-menu");
   
      userMenu.addEventListener("mouseenter", function() {
        const dropdownContent = this.querySelector(".content");
        dropdownContent.style.display = "block";
      });
   
      userMenu.addEventListener("mouseleave", function() {
        const dropdownContent = this.querySelector(".content");
        dropdownContent.style.display = "none";
      });
    });
   
   
    let arrow = document.querySelectorAll(".arrow");
    for (var i = 0; i < arrow.length; i++) {
      arrow[i].addEventListener("click", (e) => {
        let arrowParent = e.target.parentElement.parentElement; // selecting main parent of arrow
        arrowParent.classList.toggle("showMenu");
      });
    }
 
    let sidebar = document.querySelector(".sidebar");
    let sidebarBtn = document.querySelector(".bx-menu");
    sidebarBtn.addEventListener("click", () => {
      sidebar.classList.toggle("close");
    });
 
    // Function to close sidebar if clicked outside of it
    document.addEventListener("click", function(e) {
      if (!sidebar.contains(e.target) && !sidebarBtn.contains(e.target)) {
        sidebar.classList.add("close");
      }
    });
   
 
    function toggleMenu(event) {
      const menu = document.getElementById('account-menu');
      menu.classList.toggle('show');
 
      // Close the menu when clicking outside of it
      window.onclick = function(event) {
          if (!event.target.matches('.menu-trigger, .menu-trigger *')) {
              if (menu.classList.contains('show')) {
                  menu.classList.remove('show');
              }
          }
      };
  }
 
  document.addEventListener("DOMContentLoaded", function() {
    const dates = JSON.parse('{{ dates|safe|escapejs }}').slice(-10); // Example for getting initial dates from Django context
    const successCounts = JSON.parse('{{ success_counts|safe|escapejs }}').slice(-10); // Example for getting initial success counts
    const failedCounts = JSON.parse('{{ failed_counts|safe|escapejs }}').slice(-10); // Example for getting initial failed counts
 
    const combinedChartCtx = document.getElementById('combinedChart').getContext('2d');
 
    const combinedChart = new Chart(combinedChartCtx, {
        type: 'line',
        data: {
            labels: dates,
            datasets: [{
                label: 'Success',
                data: successCounts,
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                fill: false,
                pointStyle: 'line',
                borderWidth: 2,
                tension: 0.3,
            }, {
                label: 'Fail',
                data: failedCounts,
                borderColor: 'rgba(255, 99, 132, 1)',
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                fill: false,
                pointStyle: 'line',
                borderWidth: 2,
                tension: 0.3,
            }]
        },
        options: {
            responsive: false,
            maintainAspectRatio: true,
            scales: {
                x: { display: true },
                y: { display: true, color: 'white' }
            },
            plugins: {
                title: {
                    display: true,
                    text: 'Success and Fail Counts Over Time',
                    color: '#012a55',
                    font: {
                        size: 20,
                        weight: 'bold'
                    }
                },
                legend: {
                    display: false,
                    position: 'top',
                }
            }
        }
    });
 
    const searchForm = document.getElementById('searchForm');
    searchForm.addEventListener('submit', function(event) {
        event.preventDefault();
 
        const formData = new FormData(searchForm);
        const queryString = new URLSearchParams(formData).toString();
 
        fetch(`{% url "search_po_or_invoice_number" %}?${queryString}`, {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            }
        })
        .then(response => response.json())
        .then(data => {
            console.log('Server response:', data);
            document.getElementById('dashboardTable').innerHTML = data.html;
 
            // Update counts
            document.querySelector('.paragraph .span-container span').textContent = data.total_processed || 0;
            document.querySelector('.paragraph-success .span-container span').textContent = data.success_count || 0;
            document.querySelector('.paragraph-fail .span-container span').textContent = data.failed_count || 0;
 
            // Update chart data with new data from the server
            combinedChart.data.labels = data.dates || []; // Ensure data.dates is an array
            combinedChart.data.datasets[0].data = data.success_counts || []; // Ensure data.success_counts is an array
            combinedChart.data.datasets[1].data = data.failed_counts || []; // Ensure data.failed_counts is an array
            combinedChart.update(); // Update the chart
        })
        .catch(error => console.error('Error:', error));
    });
});
 
function refreshPage() {
    window.location.reload();
  }
     
  </script>
</body>
</html>
 
 