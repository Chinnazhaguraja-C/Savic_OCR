<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Folder File</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="static/folder-upload.css">
    <link rel="stylesheet" href="static/page_load.css">
    <link rel="shortcut icon" href="https://savictech.com/img/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="https://savictech.com/img/apple-touch-icon.png">
    <!-- Boxicons CDN Link -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
 
</head>
<body>
    <div class="sidebar close">
        {% comment %}
        <div class="logo-container">
            <img src="static/images/savic.png" alt="SAVIC Logo" class="logo">
        </div>
        {% endcomment %}
        <ul class="nav-links">
            <li>
                <ul class="sub-menu blank">
                    <li><a class="link_name" href="#">Hand Written Invoice</a></li>
                </ul>
            </li>
            <li>
                <div class="iocn-link">
                    <a href="#">
                        <i class='bx bx-collection'></i>
                        <span class="link_name">Hand Written Invoice</span>
                    </a>
                    <i class='bx bxs-chevron-down arrow'></i>
                </div>
                <ul class="sub-menu">
                    <li><a onclick="window.location.href='upload.html'"><img src="static/images/multi.png"
                                alt="Multi"> Multi Invoice</a></li>
                    <li><a onclick="window.location.href='folder-upload.html'"><img src="static/images/folder.png"
                                alt="folder"> Folder</a></li>
                    <li><a onclick="window.location.href='drop-menu.html'"><img src="static/images/computer_12576904.png"
                                alt="Dashboard"> Dashboard</a></li>
                </ul>
            </li>
            <li>
                <div class="iocn-link">
                    <a href="#">
                        <i class='bx bx-book-alt'></i>
                        <span class="link_name">Scanned Invoice</span>
                    </a>
                    <i class='bx bxs-chevron-down arrow'></i>
                </div>
                <ul class="sub-menu">
                    <li><a onclick="window.location.href='upload.html'"><img src="static/images/multi.png"
                                alt="Multi"> Multi Invoice</a></li>
                    <li><a onclick="window.location.href='folder-upload.html'"><img src="static/images/folder.png"
                                alt="folder"> Folder</a></li>
                    <li><a onclick="window.location.href='drop-menu.html'"><img src="static/images/computer_12576904.png"
                                alt="Dashboard"> Dashboard</a></li>
                </ul>
            </li>
            <li>
                <div class="iocn-link">
                    <a href="#">
                        <i class='bx bx-spreadsheet'></i>
                        <span class="link_name" onclick="window.location.href='excel.html'">Excel Template Upload</span>

                    </a>
                </div>
            </li>
        </ul>
    </div>
    <section class="home-section">
        <div class="home-content">
            <i class='bx bx-menu'></i>
            <h1>Upload a Folder</h1>
            {% comment %} <div class="user-menu">
                <span class="username">
                    <i class="bx bx-user-circle icon"></i>
                    <span class="greeting">Hello, {{ user.name }}!</span>
                </span>
                <div class="dropdown-content">
                    {% if user.is_authenticated %}
                    <form id="logoutForm" action="{% url 'logout' %}" method="post">
                        {% csrf_token %}
                        <a href="{% url 'logout' %}" id="logoutBtn"><i class="bx bx-log-out"></i>Logout</a>
                    </form>
                    {% else %}
                    <p>Please <a href="{% url 'login' %}">login</a> to access this page.</p>
                    {% endif %}
                </div>
            </div>
        </div> {% endcomment %}
        <div class="col-lg-2 col-md-3 col-4 ">
            <div class="menu-trigger">
                <div class="d-flex align-items-center justify-content-center gap-3 userDesign" onclick="toggleMenu(event)">
                    <img src="static/images/user.png" class="userLogo" alt="user logo" title="user logo"> 
                    <i class='fas fa-angle-down fs-4'></i>
                </div>
                <div class="menu" id="account-menu">
                    <div class="menu-arrow"></div>
                    <div class="d-flex justify-content-start align-items-center gap-3 userImageDesign" >
                       
                        <div class="userImage">
                            <img src="static/images/avatar-01.jpg" class="" alt="Vendor Dashboard">
                        </div> 
                      
                        <div class="pt-2">
                            <h5 class="fs-6"> {{ user.name }}</h5>
                            <h6 class="text-secondary f-6">{{ user.email }}</h6>
                        </div>
                    </div>
                    <div class="divider"></div>
                    <div class="divider"></div>
    
                    {% if user.is_authenticated %}
                        <form id="logoutForm" action="{% url 'logout' %}" method="post">
                        <div class="menu-item"  onclick="document.getElementById('logoutForm').submit();">
                            <div class="menu-icon">+</div>Add another account
                        </div>
                        {% comment %} <div class="menu-item">
                            <div class="menu-icon">⚙️</div>Settings
                        </div>  {% endcomment %}
                        
                            {% csrf_token %}
                            <div class="menu-item" onclick="document.getElementById('logoutForm').submit();">
                                <div class="menu-icon">↩️</div>Logout
                            </div>
                        </form>
                    {% else %}
                        <p>Please <a href="{% url 'login' %}">login</a> to access this page.</p>
                    {% endif %}
                    
                </div>
            </div>
        </div>
        
        </div>
        </div>

        <hr>

        <!-- Loading overlay -->
        <div id="processing" class="loader" style="display: none;"></div>

                        
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-6 file-upload-container">
                    <div class="upload-form-container">
                        <form class="upload-form" id="upload-form" action="/upload_invoice" method="post" enctype="multipart/form-data">
                            
                            {% csrf_token %}
                            <div>
                                <h6 style="font-weight: 700;">Upload your File Here:</h6>
                            </div>
                            <div class="drop-area" id="drop-area">
                                <div class="xl-icon">
                                    <i class="fas fa-file-excel fa-3x"></i>
                                </div>
                                <p>Drag and drop your Folder here</p>
                                <p>or</p>
                                <p>Click to select a folder</p>
                            </div>
                            <input type="file" id="invoice" name="invoice"  webkitdirectory directory multiple required
                                style="display: none;" />
                            <div class="button-group">
                                <button type="submit" value="Upload" id="upload-button" class="btn btn-success"
                                    disabled>
                                    Upload
                                </button>
                                <button type="button" id="clear-button" class="btn btn-danger" style="display: none;">
                                    Clear
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="col-lg-6 instructions-container">
                    <div class="column-instructions">
                        <h1>Instructions </h1>
<ol>
    <li><i class="fas fa-mouse-pointer"></i> Click on the dashed area or drag and drop your folder into it.</li>
    <li><i class="fas fa-folder"></i> Ensure all files within the folder are in .pdf format.</li>
    <li><i class="fas fa-weight-hanging"></i> The total size of all files should not exceed 50MB.</li>
    <li><i class="fas fa-upload"></i> After selecting the folder, click the "Upload" button.</li>
    <li><i class="fas fa-hourglass-half"></i> Wait for the upload to complete.</li>
</ol>

                    </div>
                </div>
            </div>
        </div>

        <footer id="footer">
            <span>
              © 2024,
              <a href="http://www.savictech.com" target="_blank">savic technologies pvt. ltd.</a>
              All Rights Reserved.
            </span>
          </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let arrow = document.querySelectorAll(".arrow");
        for (var i = 0; i < arrow.length; i++) {
            arrow[i].addEventListener("click", (e) => {
                let arrowParent = e.target.parentElement.parentElement; // selecting main parent of arrow
                arrowParent.classList.toggle("showMenu");
            });
        }
    
        let sidebar = document.querySelector(".sidebar");
        let sidebarBtn = document.querySelector(".bx-menu");
        sidebarBtn.addEventListener("click", () => {
            sidebar.classList.toggle("close");
        });
    
        // Function to close sidebar if clicked outside of it
        document.addEventListener("click", function(e) {
            if (!sidebar.contains(e.target) && !sidebarBtn.contains(e.target)) {
                sidebar.classList.add("close");
            }
        });
    
        const dropArea = document.getElementById("drop-area");
        const fileInput = document.getElementById("invoice");
        const uploadButton = document.getElementById("upload-button");
        const clearButton = document.getElementById("clear-button");
        let fileList = [];
    
        dropArea.addEventListener("click", () => fileInput.click());
    
        dropArea.addEventListener("dragover", (e) => {
            e.preventDefault();
            dropArea.style.backgroundColor = "#f0f9f4";
        });
    
        dropArea.addEventListener("dragleave", () => {
            dropArea.style.backgroundColor = "";
        });
    
        dropArea.addEventListener("drop", (e) => {
            e.preventDefault();
            dropArea.style.backgroundColor = "";
            for (let file of e.dataTransfer.files) {
                fileList.push({ id: fileList.length, file });
            }
            updateDropAreaText();
            updateFileInput();
        });
    
        fileInput.addEventListener("change", () => {
            for (let file of fileInput.files) {
                fileList.push({ id: fileList.length, file });
            }
            updateDropAreaText();
            updateFileInput();
        });
    
        clearButton.addEventListener("click", () => {
            fileInput.value = ""; // Reset file input
            fileList = []; // Clear file list
            updateDropAreaText(); // Update drop area text
        });
    
        function updateDropAreaText() {
            if (fileList.length > 0) {
                let fileListHTML = "<ul>";
                for (let fileObj of fileList) {
                    fileListHTML += `
                        <li>
                            <span>${fileObj.file.name}</span>
                            <button type="button" class="remove-file" data-id="${fileObj.id}">×</button>
                        </li>
                    `;
                }
                fileListHTML += "</ul>";
                dropArea.innerHTML = `
                    <p style="width: 100%; text-align: left; margin-bottom: 10px;">Files selected:</p>
                    ${fileListHTML}
                `;
                clearButton.style.display = "block";
                uploadButton.disabled = false;
    
                // Attach click event listener to each remove button
                document.querySelectorAll('.remove-file').forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.stopPropagation();
                        removeFile(parseInt(button.getAttribute('data-id')));
                    });
                });
            } else {
                dropArea.innerHTML = `
                    <div class="xl-icon">
                        <i class="fas fa-file-upload fa-3x"></i>
                    </div>
                    <p>Drag and drop your files here</p>
                    <p>or</p>
                    <p>Click to select files</p>
                `;
                clearButton.style.display = "none";
                uploadButton.disabled = true;
            }
        }
    
        function removeFile(id) {
            fileList = fileList.filter(fileObj => fileObj.id !== id);
            updateDropAreaText();
            updateFileInput();
        }
    
        function updateFileInput() {
            const dt = new DataTransfer();
            fileList.forEach(fileObj => dt.items.add(fileObj.file));
            fileInput.files = dt.files;
        }
    
        uploadButton.addEventListener("click", async () => {
            const formData = new FormData(document.getElementById("upload-form"));
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    
            try {
                const response = await fetch("/upload_invoice/", {
                    method: "POST",
                    body: formData,
                    headers: {
                        "X-CSRFToken": csrfToken
                    }
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                console.log("File uploaded successfully:", data);
                // Optionally, you can redirect or show a success message here
            } catch (error) {
                console.error("Error uploading file:", error);
            }
        });
    
        updateDropAreaText();
    
        function toggleMenu(event) {
            const menu = document.getElementById('account-menu');
            menu.classList.toggle('show');
    
            // Close the menu when clicking outside of it
            window.onclick = function(event) {
                if (!event.target.matches('.menu-trigger, .menu-trigger *')) {
                    if (menu.classList.contains('show')) {
                        menu.classList.remove('show');
                    }
                }
            };
        }
    
        // Loading overlay
        function uploadInvoice() {
            var form = document.getElementById('uploadForm');
            var processingDiv = document.getElementById('processing');
            // Show processing animation
            processingDiv.style.display = 'block';
            // Add the class to apply the CSS styles
            processingDiv.classList.add('loading-overlay');
            // Submit the form
            form.submit();
        }
    </script>
    
  
</body>
</html>
